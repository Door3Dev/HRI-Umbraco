@inherits Umbraco.Web.Macros.PartialViewMacroPage

@{
    if (User.Identity.IsAuthenticated)
    {
        var pdfLink = "/";
        var member = Members.GetCurrentMember();
        var policyNumber = member.GetPropertyValue<string>("healthPlanId");
        var market = member.GetPropertyValue<string>("market");
        var effectiveDate = member.GetPropertyValue<string>("effectiveYear");
        var homeContent = Umbraco.ContentAtRoot().First();
        string pdfFolderId = String.Empty;

        if (string.Compare(market, "group", StringComparison.OrdinalIgnoreCase) == 0)
        {
            var year = Convert.ToDateTime(effectiveDate).Year;
            if (year == 2015)
            {
                pdfFolderId = homeContent.GetPropertyValue<string>("PolicyFormsThisYear");
            }
            else if (year == 2014)
            {
                pdfFolderId = homeContent.GetPropertyValue<string>("PolicyFormsPreviousYear");
            }
        }
        else
        {
            pdfFolderId = homeContent.GetPropertyValue<string>("pdfFolder");
        }
        var docs = Umbraco.Media(pdfFolderId).Children;
        foreach (var n in docs)
        {
            if (string.Compare((string)n.Name, policyNumber + ".pdf", StringComparison.OrdinalIgnoreCase) == 0)
            {
                pdfLink = n.Url;
                break;
            }
        }
        <ul><li><a href="@pdfLink" target="_blank">Policy / Contract / Certificate of Coverage</a></li></ul>
    }
}
