@using HRI.Models
@using HRI.Services
@inherits UmbracoTemplatePage
@{
    var homePage = CurrentPage.AncestorsOrSelf(1).First();
    var showMenu = !(Request.Browser.IsMobileDevice && Request.Url.AbsolutePath.Contains("for-members/login"));
    var menuService = showMenu ? new MenuService() : null;
    var menu = showMenu ? menuService.ListItems(MenuType.Header) : null;

}

<div id="header" class="row-fluid">
  <div id="masthead" class="row-fluid">
      <div class="@(showMenu? "span3" : "span12")">
          <a href="@homePage.Url">
              <div class="logo-sm">
                  <h1>Health Republic Insurance of New York</h1>
              </div>
          </a>
      </div>
    @if (showMenu)
    {
        <div class="span9">
            <div class="navigation pull-right">
                <ul class="nav-site unstyled inline">
                    @if (!User.Identity.IsAuthenticated)
                    {
                        <li class="menu-item short"><a href="@homePage.Url">Home</a></li>
                    }           
                    @foreach (var item in menu)
                    {
                        // if the number of non-hidden items is greater than 0
                        if (item.Items.Count > 1)
                        {
                            // Create the navigation item *@
                            <li class="dropdown">
                                <a href="" data-toggle="dropdown" class="dropdown-toggle">@Html.Raw(item.Label)<span class="caret"></span></a>
                                @* Create all the sub items *@
                                <ul class="dropdown-menu">
                                    @foreach (var subpage in item.Items)
                                    {
                                        var target = subpage.ShouldOpenInTheNewTab ? "_blank" : "";
                                        // If it is a media file link it to the document set in umbraco backend content panel
                                        var url = subpage.LinkType == "ExternalFile" ? subpage.FileUrl : subpage.Url;
                                        <li class="sub-link"><a href="@url" target="@target">@Html.Raw(subpage.Label)</a></li>
                                    }
                                </ul>
                            </li>
                        }
                  @* If there are no visible links under this nav item *@
                        else
                        {
                            var target = item.ShouldOpenInTheNewTab ? "_blank" : "";
                            var url = item.Items.Count == 0 ? "#" : item.Items.First().Url;
                            // Create the nav item as a link to the first node under the Nav item in the Umbraco backend content panel *@
                            <li><a href="@url" class="dropdown-toggle" target="@target">@Html.Raw(item.Label)</a></li>
                        }
                    }   
                </ul>
            </div>
        </div>
    }
  </div>
</div>